"use strict";var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var ethNetwork,_possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn")),_getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf")),_inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits")),_regenerator=_interopRequireDefault(require("@babel/runtime/regenerator")),_asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator")),_classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck")),_createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass")),_scatterjsCore=require("scatterjs-core"),_web3ProviderEngine=_interopRequireDefault(require("web3-provider-engine")),_rpc=_interopRequireDefault(require("web3-provider-engine/subproviders/rpc")),_websocket=_interopRequireDefault(require("web3-provider-engine/subproviders/websocket")),_hookedWallet=_interopRequireDefault(require("web3-provider-engine/subproviders/hooked-wallet")),socketService=_scatterjsCore.SocketService,ScatterEthereumWallet=/*#__PURE__*/function(){function a(){(0,_classCallCheck2.default)(this,a),this.getAccounts=this.getAccounts.bind(this),this.signTransaction=this.signTransaction.bind(this)}return(0,_createClass2.default)(a,[{key:"getAccounts",value:function(){var a=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(b){var c,d;return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,socketService.sendApiRequest({type:"identityFromPermissions",payload:{}});case 2:return c=a.sent,d=c?c.accounts.filter(function(a){return a.blockchain===_scatterjsCore.Blockchains.ETH}).map(function(a){return a.address}):[],b(null,d),a.abrupt("return",d);case 6:case"end":return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()},{key:"signTransaction",value:function(){var a=(0,_asyncToGenerator2.default)(/*#__PURE__*/_regenerator.default.mark(function a(b){var c,d,e,f,g,h;return _regenerator.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(ethNetwork){a.next=2;break}throw Error.noNetwork();case 2:if(void 0!==b.gas&&(b.gasLimit=b.gas),b.value=b.value||"0x00",b.hasOwnProperty("data")&&(b.data="0x"+b.data),c=b.hasOwnProperty("requiredFields")?b.requiredFields:{},d=b.hasOwnProperty("abi")?b.abi:null,d||!b.hasOwnProperty("data")){a.next=9;break}throw Error.signatureError("no_abi","You must provide a JSON ABI along with your transaction so that users can read the contract");case 9:return e=Object.assign(b,{blockchain:_scatterjsCore.Blockchains.ETH,network:ethNetwork,requiredFields:c}),a.next=12,socketService.sendApiRequest({type:"requestSignature",payload:e});case 12:return f=a.sent,g=f.signatures,h=f.returnedFields,b.hasOwnProperty("fieldsCallback")&&b.fieldsCallback(h),a.abrupt("return",g[0]);case 17:case"end":return a.stop();}},a,this)}));return function b(){return a.apply(this,arguments)}}()}]),a}(),ScatterETH=/*#__PURE__*/function(a){function b(){return(0,_classCallCheck2.default)(this,b),(0,_possibleConstructorReturn2.default)(this,(0,_getPrototypeOf2.default)(b).call(this,_scatterjsCore.Blockchains.ETH,_scatterjsCore.PluginTypes.BLOCKCHAIN_SUPPORT))}return(0,_inherits2.default)(b,a),(0,_createClass2.default)(b,[{key:"setSocketService",value:function b(a){socketService=a}},{key:"hookProvider",value:function a(){1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};throw new Error("Ethereum hook prp")}},{key:"signatureProvider",value:function a(){return function(a,b){ethNetwork=_scatterjsCore.Network.fromJson(a);var c="".concat(ethNetwork.fullhost()),d=new _web3ProviderEngine.default,e=new b(d),f=new _hookedWallet.default(new ScatterEthereumWallet());return d.addProvider(f),-1<ethNetwork.protocol.indexOf("http")?d.addProvider(new _rpc.default({rpcUrl:c})):d.addProvider(new _websocket.default({rpcUrl:c})),d.start(),e}}}]),b}(_scatterjsCore.Plugin);exports.default=ScatterETH,"undefined"!=typeof window&&(window.ScatterETH=ScatterETH);